- id: mark_person_as_just_arrived_from_away
  alias: Mark person as just arrived from away
  trigger:
    - platform: state
      entity_id: device_tracker.daniel
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.ramon
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.mcarmen
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.amanda
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.andrea_aquarisx5
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.arturo
      from: 'not_home'
      to: 'home'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and states.input_select.daniel_home_status.state == 'Ausente' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and states.input_select.ramon_home_status.state == 'Ausente' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and states.input_select.mcarmen_home_status.state == 'Ausente' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and states.input_select.amanda_home_status.state == 'Ausente' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.andrea_aquarisx5' and states.input_select.andrea_home_status.state == 'Ausente' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.arturo' and states.input_select.arturo_home_status.state == 'Ausente' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'device_tracker.andrea_aquarisx5' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Acaba de llegar

- id: mark_person_as_just_arrived_from_extended_away
  alias: Mark person as just arrived from extended away
  trigger:
    - platform: state
      entity_id: device_tracker.daniel
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.ramon
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.mcarmen
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.amanda
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.andrea_aquarisx5
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.arturo
      from: 'not_home'
      to: 'home'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and states.input_select.daniel_home_status.state == 'Fuera' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and states.input_select.ramon_home_status.state == 'Fuera' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and states.input_select.mcarmen_home_status.state == 'Fuera' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and states.input_select.amanda_home_status.state == 'Fuera' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.andrea_aquarisx5' and states.input_select.andrea_home_status.state == 'Fuera' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.arturo' and states.input_select.arturo_home_status.state == 'Fuera' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'device_tracker.andrea_aquarisx5' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Acaba de llegar

- id: mark_person_as_just_left_from_just_arrived
  alias: Mark person as just left from just arrived
  trigger:
    - platform: state
      entity_id: device_tracker.daniel
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.ramon
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.mcarmen
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.amanda
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.andrea_aquarisx5
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.arturo
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.daniel_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.ramon_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.mcarmen_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.amanda_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.andrea_aquarisx5' and states.input_select.andrea_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.arturo' and states.input_select.arturo_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'device_tracker.andrea_aquarisx5' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Acaba de irse

- id: mark_person_as_home_from_just_arrived
  alias: Mark person as home from just arrived
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: 'Acaba de llegar'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.ramon_home_status
      to: 'Acaba de llegar'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.mcarmen_home_status
      to: 'Acaba de llegar'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.amanda_home_status
      to: 'Acaba de llegar'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.andrea_home_status
      to: 'Acaba de llegar'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.arturo_home_status
      to: 'Acaba de llegar'
      for:
        minutes: 10
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' and states.input_select.daniel_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.ramon_home_status' and states.input_select.ramon_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.mcarmen_home_status' and states.input_select.mcarmen_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.amanda_home_status' and states.input_select.amanda_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.andrea_home_status' and states.input_select.andrea_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.arturo_home_status' and states.input_select.arturo_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'input_select.ramon_home_status' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'input_select.mcarmen_home_status' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'input_select.amanda_home_status' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'input_select.andrea_home_status' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Casa

- id: mark_person_as_just_left_from_home
  alias: Mark person as just left from home
  trigger:
    - platform: state
      entity_id: device_tracker.daniel
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.ramon
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.mcarmen
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.amanda
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.andrea_aquarisx5
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.arturo
      from: 'home'
      to: 'not_home'
      for:
        minutes: 2
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.daniel_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.ramon_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.mcarmen_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 23 and states.input_select.amanda_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.andrea_aquarisx5' and states.input_select.andrea_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.arturo' and states.input_select.arturo_home_status.state == 'Casa' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'device_tracker.andrea_aquarisx5' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Acaba de irse

- id: mark_person_as_home_from_just_left
  alias: Mark person as home from just left
  trigger:
    - platform: state
      entity_id: device_tracker.daniel
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.ramon
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.mcarmen
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.amanda
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.andrea_aquarisx5
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.arturo
      from: 'not_home'
      to: 'home'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and states.input_select.daniel_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and states.input_select.ramon_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and states.input_select.mcarmen_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and states.input_select.amanda_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.andrea_aquarisx5' and states.input_select.andrea_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.arturo' and states.input_select.arturo_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'device_tracker.andrea_aquarisx5' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Casa

- id: mark_person_as_away_from_just_left
  alias: Mark person as away from just left
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: 'Acaba de irse'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.ramon_home_status
      to: 'Acaba de irse'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.mcarmen_home_status
      to: 'Acaba de irse'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.amanda_home_status
      to: 'Acaba de irse'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.andrea_home_status
      to: 'Acaba de irse'
      for:
        minutes: 10
    - platform: state
      entity_id: input_select.arturo_home_status
      to: 'Acaba de irse'
      for:
        minutes: 10
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' and states.input_select.daniel_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.ramon_home_status' and states.input_select.ramon_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.mcarmen_home_status' and states.input_select.mcarmen_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.amanda_home_status' and states.input_select.amanda_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.andrea_home_status' and states.input_select.andrea_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.arturo_home_status' and states.input_select.arturo_home_status.state == 'Acaba de irse' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'input_select.ramon_home_status' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'input_select.mcarmen_home_status' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'input_select.amanda_home_status' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'input_select.andrea_home_status' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Ausente

- id: mark_person_as_extended_away_from_away
  alias: Mark person as extended away from away
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status, input_select.ramon_home_status, input_select.amanda_home_status, input_select.andrea_home_status, input_select.arturo_home_status
      to: 'Ausente'
      for:
        hours: 20
    - platform: time
      minutes: '/30'
      seconds: 0
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: trigger.entity_id
          state: Ausente
          for:
            hours: 20
        - condition: or
          conditions:
            - condition: template
              value_template: >
                {% if trigger.entity_id == 'input_select.daniel_home_status' and states.input_select.daniel_home_status.state == 'Ausente' %}
                  true
                {% endif %}
            - condition: template
              value_template: >
                {% if trigger.entity_id == 'input_select.ramon_home_status' and states.input_select.ramon_home_status.state == 'Ausente' %}
                  true
                {% endif %}
            - condition: template
              value_template: >
                {% if trigger.entity_id == 'input_select.mcarmen_home_status' and states.input_select.mcarmen_home_status.state == 'Ausente' %}
                  true
                {% endif %}
            - condition: template
              value_template: >
                {% if trigger.entity_id == 'input_select.amanda_home_status' and states.input_select.amanda_home_status.state == 'Ausente' %}
                  true
                {% endif %}
            - condition: template
              value_template: >
                {% if trigger.entity_id == 'input_select.andrea_home_status' and states.input_select.andrea_home_status.state == 'Ausente' %}
                  true
                {% endif %}
            - condition: template
              value_template: >
                {% if trigger.entity_id == 'input_select.arturo_home_status' and states.input_select.arturo_home_status.state == 'Ausente' %}
                  true
                {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'input_select.ramon_home_status' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'input_select.mcarmen_home_status' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'input_select.amanda_home_status' %}
            input_select.amanda_home_status
          {% elif trigger.entity_id == 'input_select.andrea_home_status' %}
            input_select.andrea_home_status
          {% else %}
            input_select.arturo_home_status
          {% endif %}
        option: Fuera

- id: mark_person_as_bed_from_just_arrived
  alias: Mark person as bed from just arrived
  trigger:
    - platform: state
      entity_id: input_select.daniel_status
      to: 'Cama'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_status' and states.input_select.daniel_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_status' %}
            input_select.daniel_home_status
          {% endif %}
        option: Cama

- id: mark_person_as_bed_from_home
  alias: Mark person as bed from home
  trigger:
    - platform: state
      entity_id: input_select.daniel_status
      to: 'Cama'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_status' and states.input_select.daniel_home_status.state == 'Casa' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_status' %}
            input_select.daniel_home_status
          {% endif %}
        option: Cama

- id: mark_person_as_home_from_bed
  alias: Mark person as home from bed
  trigger:
    - platform: state
      entity_id: input_select.daniel_status
      to: 'Standby'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_status' and states.input_select.daniel_home_status.state == 'Cama' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_status' %}
            input_select.daniel_home_status
          {% endif %}
        option: Casa

- id: mark_person_as_sleeping_from_bed
  alias: Mark person as sleeping from bed
  trigger:
    - platform: state
      entity_id: input_select.daniel_status
      to: 'Durmiendo'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_status' and states.input_select.daniel_home_status.state == 'Cama' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_status' %}
            input_select.daniel_home_status
          {% endif %}
        option: Durmiendo

- id: mark_person_as_sleeping_from_just_arrived
  alias: Mark person as sleeping from just arrived
  trigger:
    - platform: state
      entity_id: input_select.daniel_status
      to: 'Durmiendo'
    - platform: state
      entity_id: device_tracker.daniel
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.ramon
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.mcarmen
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.amanda
      to: 'not_home'
      for:
        minutes: 2
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_status' and states.input_select.daniel_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 5 and states.input_select.daniel_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 4 and states.input_select.ramon_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 5 and states.input_select.mcarmen_home_status.state == 'Acaba de llegar' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 5 and states.input_select.amanda_home_status.state == 'Casa' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_status' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% endif %}
        option: Durmiendo

- id: mark_person_as_sleeping_from_home
  alias: Mark person as sleeping from home
  trigger:
    - platform: state
      entity_id: input_select.daniel_status
      to: 'Durmiendo'
    - platform: state
      entity_id: device_tracker.daniel
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.ramon
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.mcarmen
      to: 'not_home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.amanda
      to: 'not_home'
      for:
        minutes: 2
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_status' and states.input_select.daniel_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 5 and states.input_select.daniel_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 4 and states.input_select.ramon_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 5 and states.input_select.mcarmen_home_status.state == 'Casa' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and now().strftime("%H")|int >= 0 and now().strftime("%H")|int <= 5 and states.input_select.amanda_home_status.state == 'Casa' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_status' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% endif %}
        option: Durmiendo

- id: mark_person_as_home_from_sleeping
  alias: Mark person as home from sleeping
  trigger:
    - platform: state
      entity_id: input_select.daniel_status
      to: 'Standby'
    - platform: state
      entity_id: device_tracker.daniel
      to: 'home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.ramon
      to: 'home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.mcarmen
      to: 'home'
      for:
        minutes: 2
    - platform: state
      entity_id: device_tracker.amanda
      to: 'home'
      for:
        minutes: 2
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_status' and states.input_select.daniel_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.daniel' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 12 and states.input_select.daniel_status.state != 'Durmiendo' and states.input_select.daniel_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.ramon' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 12 and states.input_select.ramon_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.mcarmen' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 12 and states.input_select.mcarmen_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'device_tracker.amanda' and now().strftime("%H")|int >= 6 and now().strftime("%H")|int <= 12 and states.input_select.amanda_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_status' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.daniel' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'device_tracker.ramon' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'device_tracker.mcarmen' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'device_tracker.amanda' %}
            input_select.amanda_home_status
          {% endif %}
        option: Casa

- id: mark_person_as_away_from_sleeping
  alias: Mark person as away from sleeping
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: 'Durmiendo'
      for:
        hours: 11
    - platform: state
      entity_id: input_select.ramon_home_status
      to: 'Durmiendo'
      for:
        hours: 11
    - platform: state
      entity_id: input_select.mcarmen_home_status
      to: 'Durmiendo'
      for:
        hours: 11
    - platform: state
      entity_id: input_select.amanda_home_status
      to: 'Durmiendo'
      for:
        hours: 11
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' and states.device_tracker.daniel.state != 'home' and states.input_select.daniel_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.ramon_home_status' and states.device_tracker.ramon.state != 'home' and states.input_select.ramon_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.mcarmen_home_status' and states.device_tracker.mcarmen.state != 'home' and states.input_select.mcarmen_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
      - condition: template
        value_template: >
          {% if trigger.entity_id == 'input_select.amanda_home_status' and states.device_tracker.amanda.state != 'home' and states.input_select.amanda_home_status.state == 'Durmiendo' %}
            true
          {% endif %}
  action:
    - service: input_select.select_option
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' %}
            input_select.daniel_home_status
          {% elif trigger.entity_id == 'input_select.ramon_home_status' %}
            input_select.ramon_home_status
          {% elif trigger.entity_id == 'input_select.mcarmen_home_status' %}
            input_select.mcarmen_home_status
          {% elif trigger.entity_id == 'input_select.amanda_home_status' %}
            input_select.amanda_home_status
          {% endif %}
        option: Ausente

- id: set_home_occupied_from_not_occupied_or_vacations
  alias: Marcar Casa como Habitada desde Deshabitada o Vacaciones
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.ramon_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.mcarmen_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.amanda_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.andrea_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.arturo_home_status
      to: 'Acaba de llegar'
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.home_status
          state: 'Deshabitada'
        - condition: state
          entity_id: input_select.home_status
          state: 'Vacaciones'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Habitada

- id: set_home_not_occupied_from_occupied
  alias: Marcar Casa como Deshabitada desde Habitada
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: 'Ausente'
    - platform: state
      entity_id: input_select.ramon_home_status
      to: 'Ausente'
    - platform: state
      entity_id: input_select.mcarmen_home_status
      to: 'Ausente'
    - platform: state
      entity_id: input_select.amanda_home_status
      to: 'Ausente'
    - platform: state
      entity_id: input_select.andrea_home_status
      to: 'Ausente'
    - platform: state
      entity_id: input_select.arturo_home_status
      to: 'Ausente'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_select.home_status
          state: 'Habitada'
        - condition: or
          conditions:
            - condition: state
              entity_id: input_select.daniel_home_status
              state: 'Ausente'
            - condition: state
              entity_id: input_select.daniel_home_status
              state: 'Fuera'
        - condition: or
          conditions:
            - condition: state
              entity_id: input_select.ramon_home_status
              state: 'Ausente'
            - condition: state
              entity_id: input_select.ramon_home_status
              state: 'Fuera'
        - condition: or
          conditions:
            - condition: state
              entity_id: input_select.mcarmen_home_status
              state: 'Ausente'
            - condition: state
              entity_id: input_select.mcarmen_home_status
              state: 'Fuera'
        - condition: or
          conditions:
            - condition: state
              entity_id: input_select.amanda_home_status
              state: 'Ausente'
            - condition: state
              entity_id: input_select.amanda_home_status
              state: 'Fuera'
        - condition: or
          conditions:
            - condition: state
              entity_id: input_select.andrea_home_status
              state: 'Ausente'
            - condition: state
              entity_id: input_select.andrea_home_status
              state: 'Fuera'
        - condition: or
          conditions:
            - condition: state
              entity_id: input_select.arturo_home_status
              state: 'Ausente'
            - condition: state
              entity_id: input_select.arturo_home_status
              state: 'Fuera'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Deshabitada

- id: set_home_vacations_from_not_occupied
  alias: Marcar Casa como Vacaciones desde Deshabitada
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: 'Fuera'
    - platform: state
      entity_id: input_select.ramon_home_status
      to: 'Fuera'
    - platform: state
      entity_id: input_select.mcarmen_home_status
      to: 'Fuera'
    - platform: state
      entity_id: input_select.amanda_home_status
      to: 'Fuera'
    - platform: state
      entity_id: input_select.andrea_home_status
      to: 'Fuera'
    - platform: state
      entity_id: input_select.arturo_home_status
      to: 'Fuera'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_select.home_status
          state: 'Deshabitada'
        - condition: state
          entity_id: input_select.daniel_home_status
          state: 'Fuera'
        - condition: state
          entity_id: input_select.ramon_home_status
          state: 'Fuera'
        - condition: state
          entity_id: input_select.mcarmen_home_status
          state: 'Fuera'
        - condition: state
          entity_id: input_select.amanda_home_status
          state: 'Fuera'
        - condition: state
          entity_id: input_select.andrea_home_status
          state: 'Fuera'
        - condition: state
          entity_id: input_select.arturo_home_status
          state: 'Fuera'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Vacaciones

- id: away_everyone_turn_off_lights
  alias: Apagar luces con Casa Deshabitada
  trigger:
    - platform: state
      entity_id: input_select.home_status
      from: 'Habitada'
      to: 'Deshabitada'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: group.all_lights
          state: 'on'
  action:
    - service: script.all_lights_off
    - service: script.notify_ligths_on
    
- id: away_daniel
  alias: Away Daniel
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      from: 'Acaba de irse'
      to: 'Ausente'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: group.luces_daniel
          state: 'on'
  action:
    - service: script.daniel_lights_off
    - service: script.notify_daniel_lights_on

- id: daniel_bedtime_on
  alias: Daniel Bedtime on
  trigger:
    platform: state
    entity_id: input_boolean.daniel_bedtime
    to: "on"
  condition:
    - condition: and
      conditions:
        - condition: or
          conditions:
          - condition: state
            entity_id: input_select.daniel_home_status
            state: 'Casa'
          - condition: state
            entity_id: input_select.daniel_home_status
            state: 'Acaba de llegar'
        - condition: template
          value_template: '{{ states.input_select.daniel_home_status.state != "Durmiendo" }}'
  action:
    - service: script.daniel_bedtime

- id: daniel_bedtime_off
  alias: Daniel Bedtime off
  trigger:
    - platform: time
      at: '06:00:00'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.daniel_bedtime
          state: "on"
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.daniel_bedtime

- id: daniel_in_bed
  alias: Daniel en la cama
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: "Cama"
  action:
    - service: script.daniel_bed

- id: daniel_sleeping
  alias: Daniel Sleeping
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: "Durmiendo"
  action:
    - service: script.daniel_sleeping

- id: daniel_wakeup
  alias: Daniel Wake Up
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      from: "Durmiendo"
      to: "Casa"
  action:
    - service: script.daniel_wakeup

- id: ramon_wakeup
  alias: Ramon Wake Up
  trigger:
    - platform: state
      entity_id: input_select.ramon_home_status
      from: "Durmiendo"
      to: "Casa"
  action:
    - service: script.ramon_wakeup

- id: mcarmen_wakeup
  alias: MCarmen Wake Up
  trigger:
    - platform: state
      entity_id: input_select.mcarmen_home_status
      from: "Durmiendo"
      to: "Casa"
  action:
    - service: script.mcarmen_wakeup

- id: termo_on
  alias: Encendido Automatico Termo
  trigger:
    - platform: time
      minutes: '/30'
      seconds: 0
  condition:
    - condition: or
      conditions:
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.termo_time_on1.state }}'
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.termo_time_on2.state }}'
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.termo_time_on3.state }}'
  action:
    - service: switch.turn_on
      entity_id: switch.termo
    - delay: 00:05
    - service: switch.turn_on
      entity_id: switch.termo
    - delay: 00:05
    - condition: and
      conditions:
        - condition: state
          entity_id: switch.termo
          state: 'off'
    - service: notify.telegram_daniel
      data_template:
        message: 'El Termo no ha podido encenderse a la hora especificada. Comprobar el estado del dispositivo ya que algunas funcionalidades dejarán de estar disponibles'
        title: Alerta de dispositivo

- id: termo_off
  alias: Apagado Automatico Termo
  trigger:
    - platform: time
      minutes: '/30'
      seconds: 0
  condition:
    - condition: or
      conditions:
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.termo_time_off1.state }}'
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.termo_time_off2.state }}'
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.termo_time_off3.state }}'
  action:
    - service: switch.turn_off
      entity_id: switch.termo
    - delay: 00:05
    - service: switch.turn_off
      entity_id: switch.termo
    - delay: 00:05
    - condition: and
      conditions:
        - condition: state
          entity_id: switch.termo
          state: 'on'
    - service: notify.telegram_daniel
      data_template:
        message: 'El Termo no ha podido apagarse a la hora especificada. Comprobar el estado del dispositivo ya que algunas funcionalidades dejarán de estar disponibles'
        title: Alerta de dispositivo

- id: workstation_on
  alias: Workstation On
  trigger:
    - platform: state
      entity_id: device_tracker.strixstation
      from: 'not_home'
      to: 'home'
  action:
    - service: switch.turn_on
      entity_id: switch.workstation

- id: workstation_off
  alias: Workstation Off
  trigger:
    - platform: state
      entity_id: device_tracker.strixstation
      from: 'home'
      to: 'not_home'
      for:
        minutes: 5
  action:
    - service: switch.turn_off
      entity_id: switch.workstation

- id: tv_mode_on
  alias: TV mode ON
  trigger:
    - platform: state
      entity_id: device_tracker.television_lg
      from: "not_home"
      to: "home"
    - platform: sun
      event: sunset
  condition:
    - condition: and
      conditions: 
        - condition: sun
          after: sunset
        - condition: state
          entity_id: device_tracker.television_lg
          state: "home"
  action:
    - service: script.livingroom_lights_tv_on

- id: tv_mode_off
  alias: TV mode OFF
  trigger:
    - platform: state
      entity_id: device_tracker.television_lg
      from: "home"
      to: "not_home"
      for:
        minutes: 2
  action:
    - service: script.livingroom_lights_off

- id: radiators_auto_on
  alias: Radiators Auto ON
  trigger:
    - platform: time
      at: '20:30:00'
  condition:
    - condition: and
      conditions:
        - condition: template
          value_template: '{{ states.sensor.medium_temp_calculation.state | float <= states.input_select.radiators_threshold_temperature.state | float }}'
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.radiators_tomorrow

- id: radiators_auto_off
  alias: "Radiators Auto OFF"
  trigger:
    - platform: time
      at: '16:00:00'
  condition:
    - condition: and
      conditions:
        - condition: template
          value_template: '{{ states.sensor.medium_temp_calculation.state | float > states.input_select.radiators_threshold_temperature.state | float }}'
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.radiators_tomorrow

- id: radiator_daniel_on
  alias: "Encendido Automatico Radiador Daniel"
  trigger:
    - platform: time
      minutes: '/30'
      seconds: 0
  condition:
    - condition: and
      conditions:
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.radiator_daniel_time_on.state }}'
        - condition: state
          entity_id: input_boolean.radiators_tomorrow
          state: "on"
  action:
    - service: switch.turn_on
      entity_id: switch.radiador_daniel
    - delay: 00:05
    - service: switch.turn_on
      entity_id: switch.radiador_daniel
    - delay: 00:05
    - condition: and
      conditions:
        - condition: state
          entity_id: switch.radiador_daniel
          state: 'off'
    - service: notify.telegram_daniel
      data_template:
        message: 'El Radiador Daniel no ha podido encenderse a la hora especificada. Comprobar el estado del dispositivo ya que algunas funcionalidades dejarán de estar disponibles'
        title: Alerta de dispositivo

- id: radiator_daniel_off
  alias: "Apagado Automatico Radiador Daniel"
  trigger:
    - platform: time
      minutes: '/30'
      seconds: 0
  condition:
    - condition: and
      conditions:
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.radiator_daniel_time_off.state }}'
  action:
    - service: switch.turn_off
      entity_id: switch.radiador_daniel
    - delay: 00:05
    - service: switch.turn_off
      entity_id: switch.radiador_daniel
    - delay: 00:05
    - condition: and
      conditions:
        - condition: state
          entity_id: switch.radiador_daniel
          state: 'on'
    - service: notify.telegram_daniel
      data_template:
        message: 'El Radiador Daniel no ha podido apagarse a la hora especificada. Comprobar el estado del dispositivo ya que algunas funcionalidades dejarán de estar disponibles'
        title: Alerta de dispositivo

- id: welcome_home
  alias: Bienvenidos a Casa
  trigger:
    - platform: state
      entity_id: input_select.daniel_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.ramon_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.mcarmen_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.amanda_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.andrea_home_status
      to: 'Acaba de llegar'
    - platform: state
      entity_id: input_select.arturo_home_status
      to: 'Acaba de llegar'
  condition:
    - condition: and
      conditions:
        - condition: time
          after: '7:00:00'
          before: '05:30:00'
  action:
    - service: script.welcome_home
    - service: script.turn_on
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'input_select.daniel_home_status' %}
            script.welcome_home_daniel
          {% elif trigger.entity_id == 'input_select.ramon_home_status' %}
            script.welcome_home_ramon
          {% elif trigger.entity_id == 'input_select.mcarmen_home_status' %}
            script.welcome_home_mcarmen
          {% elif trigger.entity_id == 'input_select.amanda_home_status' %}
            script.welcome_home_amanda
          {% elif trigger.entity_id == 'input_select.andrea_home_status' %}
            script.welcome_home_andrea
          {% else %}
            script.welcome_home_arturo
          {% endif %}

- id: presencia_daniel_on
  alias: Presencia Daniel ON
  trigger:
    - platform: state
      entity_id: binary_sensor.pir_daniel
      from: "off"
      to: "on"
    - platform: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: light.luz_principal
          state: 'off'
        - condition: state
          entity_id: binary_sensor.pir_daniel
          state: 'on'
        - condition: state
          entity_id: sun.sun
          state: 'below_horizon'
        - condition: template
          value_template: >
            {% if states.input_select.daniel_home_status.state != 'Durmiendo' and states.input_select.daniel_home_status.state != 'Cama' %}
              true
            {% endif %}
        - condition: state
          entity_id: input_select.home_status
          state: 'Habitada'
  action:
    - service: light.turn_on
      entity_id: light.luz_principal

- id: presencia_daniel_off
  alias: Presencia Daniel OFF
  trigger:
    - platform: state
      entity_id: binary_sensor.pir_daniel
      from: 'on'
      to: 'off'
      for:
        minutes: 3
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: light.luz_principal
          state: 'on'
  action:
    - service: light.turn_off
      entity_id: light.luz_principal

- id: alert_when_a_critical_device_goes_offline
  alias: Alert when a critical device goes offline
  trigger:
    - platform: state
      entity_id: binary_sensor.somfy_connexoon, binary_sensor.luz_cama_status, binary_sensor.lamparita_status, binary_sensor.lampara_mesa_status, binary_sensor.workstation_status, binary_sensor.luz_principal_status, binary_sensor.luz_pasillo_status, binary_sensor.termo_status, binary_sensor.luz_ambiente, binary_sensor.lampara_pie, binary_sensor.aspi
      from: 'on'
      to: 'off'
      for:
        minutes: 8
  action:
    - service: notify.telegram_daniel
      data_template:
        message: ' El estado de {{trigger.to_state.attributes.friendly_name}} es Offline. Comprobar el estado del dispositivo ya que algunas funcionalidades dejarán de estar disponibles'
        title: Alerta de dispositivo

- id: alert_when_a_critical_device_goes_online
  alias: Alert when a critical device goes online
  trigger:
    - platform: state
      entity_id: binary_sensor.somfy_connexoon, binary_sensor.luz_cama_status, binary_sensor.lamparita_status, binary_sensor.lampara_mesa_status, binary_sensor.workstation_status, binary_sensor.luz_principal_status, binary_sensor.luz_pasillo_status, binary_sensor.termo_status, binary_sensor.luz_ambiente, binary_sensor.lampara_pie, binary_sensor.aspi
      from: 'off'
      to: 'on'
      for:
        minutes: 4
  action:
    - service: notify.telegram_daniel
      data_template:
        message: '{{trigger.to_state.attributes.friendly_name}} se ha restablecido con éxito y su estado es Online'
        title: Alerta de dispositivo

- id: alert_when_all_critical_devices_go_online
  alias: Alert when all critical devices go online
  trigger:
    - platform: state
      entity_id: binary_sensor.somfy_connexoon, binary_sensor.luz_cama_status, binary_sensor.lamparita_status, binary_sensor.lampara_mesa_status, binary_sensor.workstation_status, binary_sensor.luz_principal_status, binary_sensor.luz_pasillo_status, binary_sensor.termo_status, binary_sensor.luz_ambiente, binary_sensor.lampara_pie, binary_sensor.aspi
      from: 'off'
      to: 'on'
      for:
        minutes: 5
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: binary_sensor.somfy_connexoon
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_cama_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.lamparita_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.lampara_mesa_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.workstation_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_principal_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_pasillo_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.termo_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_ambiente
          state: 'on'
        - condition: state
          entity_id: binary_sensor.lampara_pie
          state: 'on'
        - condition: state
          entity_id: binary_sensor.aspi
          state: 'on'
  action:
    - service: notify.telegram_daniel
      data_template:
        message: ' El estado de {{trigger.to_state.attributes.friendly_name}} es Offline. Comprobar el estado del dispositivo ya que algunas funcionalidades dejarán de estar disponibles'
        title: Alerta de dispositivo

- id: alert_when_a_critical_device_goes_online
  alias: Alert when a critical device goes online
  trigger:
    - platform: state
      entity_id: binary_sensor.somfy_connexoon, binary_sensor.luz_cama_status, binary_sensor.lamparita_status, binary_sensor.lampara_mesa_status, binary_sensor.workstation_status, binary_sensor.luz_principal_status, binary_sensor.luz_pasillo_status, binary_sensor.termo_status, binary_sensor.luz_ambiente, binary_sensor.lampara_pie, binary_sensor.aspi
      from: 'off'
      to: 'on'
      for:
        minutes: 2
  action:
    - service: notify.telegram_daniel
      data_template:
        message: '{{trigger.to_state.attributes.friendly_name}} se ha restablecido con éxito y su estado es Online'
        title: Alerta de dispositivo

- id: alert_when_all_critical_devices_go_online
  alias: Alert when all critical devices go online
  trigger:
    - platform: state
      entity_id: binary_sensor.somfy_connexoon, binary_sensor.luz_cama_status, binary_sensor.lamparita_status, binary_sensor.lampara_mesa_status, binary_sensor.workstation_status, binary_sensor.luz_principal_status, binary_sensor.luz_pasillo_status, binary_sensor.termo_status, binary_sensor.luz_ambiente, binary_sensor.lampara_pie, binary_sensor.aspi
      from: 'off'
      to: 'on'
      for:
        minutes: 3
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: binary_sensor.somfy_connexoon
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_cama_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.lamparita_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.lampara_mesa_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.workstation_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_principal_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_pasillo_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.termo_status
          state: 'on'
        - condition: state
          entity_id: binary_sensor.luz_ambiente
          state: 'on'
        - condition: state
          entity_id: binary_sensor.lampara_pie
          state: 'on'
        - condition: state
          entity_id: binary_sensor.aspi
          state: 'on'
  action:
    - service: notify.telegram_daniel
      data_template:
        message: 'Todos los dispositivos se han restablecido con éxito a estado Online. Último dispositivo restablecido: {{trigger.to_state.attributes.friendly_name}}'
        title: Alerta de dispositivo
        
- id: alert_when_device_is_on_for_a_long_period
  alias: Alert when device is on for a long period
  trigger:
    - platform: state
      entity_id: switch.termo, light.luz_principal, light.luz_pasillo, light.luz_cama, light.luz_ambiente, light.lamparita, light.lampara_mesa, light.lampara_pie
      to: 'on'
      for:
        hours: 7
  action:
    - service: notify.telegram_daniel
      data_template:
        message: '{{trigger.to_state.attributes.friendly_name}} lleva encendido mucho tiempo. Comprobar su correcto funcionamiento'
        title: 'Aviso de posible malfuncionamiento'

- id: aspirado_con_casa_deshabitada
  alias: Aspirado con Casa Deshabitada
  trigger:
    - platform: state
      entity_id: input_select.home_status
      from: 'Habitada'
      to: 'Deshabitada'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.daily_vacuum_completed
          state: 'off'
  action:
    - service: script.aspi_on

- id: aspirado_automatico_diario
  alias: Aspirado Automático Diario
  trigger:
    - platform: time
      minutes: '/30'
      seconds: 0
  condition:
    - condition: and
      conditions:
        - condition: template
          value_template: '{{ now().time().strftime("%H:%M") == states.input_select.aspi_time.state }}'
        - condition: state
          entity_id: binary_sensor.aspirado_completado
          state: 'off'
        - condition: state
          entity_id: binary_sensor.aspirado_programado
          state: 'on'
        - condition: state
          entity_id: input_select.home_status
          state: 'Habitada'
  action:
    - service: script.aspi_on

- id: daniel_de_standby_a_cama
  alias: Daniel de Standby a Cama
  trigger:
    - platform: state
      entity_id: light.luz_cama
      to: 'on'
  condition:
    - condition: template
      value_template: >
        {% if states.input_select.daniel_home_status.state == 'Casa' or states.input_select.daniel_home_status.state == 'Acaba de llegar' %}
          true
        {% endif %}
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.daniel_status
        option: Cama

- id: daniel_de_cama_a_standby
  alias: Daniel de Cama a Standby
  trigger:
    - platform: state
      entity_id: light.luz_cama
      to: 'off'
  condition:
    - condition: state
      entity_id: input_select.daniel_home_status
      state: Cama
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.daniel_status
        option: Standby

- id: daniel_de_standby_a_durmiendo
  alias: Daniel de Standby a Durmiendo
  trigger:
    - platform: state
      entity_id: input_boolean.dash_gillette
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.daniel_home_status
          state: Acaba de llegar
        - condition: state
          entity_id: input_select.daniel_home_status
          state: Casa
        - condition: state
          entity_id: input_select.daniel_home_status
          state: Cama
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.daniel_status
        option: Durmiendo

- id: daniel_de_durmiendo_a_standby
  alias: Daniel de Durmiendo a Standby
  trigger:
    - platform: state
      entity_id: input_boolean.dash_gillette
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_select.daniel_home_status
          state: Durmiendo
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.daniel_status
        option: Standby
